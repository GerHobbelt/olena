#! /bin/bash

if [ "$1" = "--debug" ]; then
    DEBUG_FLAGS=" -g -ggdb "
    OPT_FLAGS=""
else
    OPT_FLAGS=" -DNDEBUG -O3 "
    DEBUG_FLAGS=""
fi

CXXFLAGS="-Wall -Wextra -W -pedantic "

echo -n '  => Generating Makefile...'

echo 'CXX=g++' > Makefile
echo 'CXXFLAGS='${CXXFLAGS} >> Makefile
echo '' >> Makefile
echo 'DEBUG_FLAGS = ' ${DEBUG_FLAGS} >> Makefile
echo 'OPT_FLAGS = ' ${OPT_FLAGS} >> Makefile
echo 'CXXFLAGS += ${DEBUG_FLAGS}' >> Makefile
echo 'CXXFLAGS += ${OPT_FLAGS}' >> Makefile
echo '' >> Makefile
echo 'SRC = morpho.cc' >> Makefile
echo 'HEADERS = $(SRC:.cc=.hh)' >> Makefile
echo 'OBJS = $(SRC:.cc=.o)' >> Makefile
echo '' >> Makefile
echo 'LIB_PATH=' ${LIB_PATH} >> Makefile
echo 'LIB=' ${LIB} >> Makefile
echo '' >> Makefile
echo '' >> Makefile
echo 'all: morpho' >> Makefile
echo '' >> Makefile
echo 'clean:' >> Makefile
echo '	rm -f *~ \#*\# *.o morpho a.out' >> Makefile
echo '' >> Makefile
echo '' >> Makefile
echo '' >> Makefile
echo 'morpho: $(OBJS)' >> Makefile
echo '	$(CXX) $(CXXFLAGS)  ${LIB_PATH} ${OBJS} -o $@ ${LIB}' >> Makefile
echo '' >> Makefile
echo '' >> Makefile
echo '%.o: %.cc' >> Makefile
echo '	$(CXX) $(CXXFLAGS) ' -I../../../../ '-c $< -o $@' >> Makefile
echo '' >> Makefile
echo '  [DONE]'
